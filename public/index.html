<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title><%= htmlWebpackPlugin.options.title %></title>
      <style type="text/css">
          .panel-title {
              display: inline;
              font-weight: bold;
          }

          .display-table {
              display: table;
          }

          .display-tr {
              display: table-row;
          }

          .display-td {
              display: table-cell;
              vertical-align: middle;
              width: 61%;
          }
      </style>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
  </body>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="http://127.0.0.1:8000/js/jquery.creditCardValidator.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.6.0/cleave.min.js" integrity="sha512-KaIyHb30iXTXfGyI9cyKFUIRSSuekJt6/vqXtyQKhQP6ozZEGY8nOtRS6fExqE4+RbYHus2yGyYg1BrqxzV6YA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
  
  <script type="text/javascript">
	  
	  $("#order").val('4444');
	  
	  $("#user").val('777');
	  
      $("#loading").css({
          display: "none"

      });
      $("#content").css("opacity","1");
      $(function() {

          var cleave = new Cleave('.card-number', {
              creditCard: true,
          });

          var cleave = new Cleave('.card-expiry', {
              date: true,
              delimiter: '/',
              datePattern: ['m', 'Y']
          });

          var cleave = new Cleave('.card-cvc', {
              numeral: true,
              numeralDecimalMark: '',
              delimiter: '',

          });
          $('.card-number').validateCreditCard(function(result) {

              if ($(".card-number").val().length > 0) {
                  $("#cardnumber").addClass("is-invalid");
                  $(".card-valid-lable").css("display", "block");
              }

              if (result.card_type != null) {

                  $("#cardnumber").removeClass("is-invalid");
                  $(".card-valid-lable").css("display", "none");


                  var cardBrandToClass = {
                      visa: "fab fa-cc-visa",
                      mastercard: "fab fa-cc-mastercard",
                      amex: "fab fa-cc-amex",
                      discover: "fab fa-cc-discover",
                      diners: "fab fa-cc-diners-club",
                      jcb: "fab fa-cc-jcb",
                      unknown: "unknown",
                  };

                  console.log(cardBrandToClass[result.card_type.name]);
                  $("#cardIcons").html('<span class="input-group-text" id="basic-addon1" > <i class="' + cardBrandToClass[result.card_type.name] + '"></i></span>');

              }

              if (result.valid) {
                  $(this).addClass('cc-valid');
              } else {
                  $(this).removeClass('cc-valid');
              }
          });
      });


      $(function() {
          var $form = $(".require-validation");
          $('form.require-validation').bind('submit', function(e) {

              $("#loading").css({
                  display: "block",
                  top:"50%",
                  left:"50%",
                  marginTop: "-50px",
                  marginLeft: "-50px",
                  width: "100px",
                  height: "100px",
                  position:"absolute",
                  zIndex: "9999",

              });
              $("#content").css("opacity","0.4");

              var expiry = $('.card-expiry').val();
              var expiry_array = expiry.split('/');

              var $form = $(".require-validation"),
                  inputSelector = ['input[type=email]', 'input[type=password]',
                      'input[type=text]', 'input[type=file]',
                      'textarea'
                  ].join(', '),
                  $inputs = $form.find('.required').find(inputSelector),
                  $errorMessage = $form.find('div.error'),
                  valid = true;
              $errorMessage.addClass('hide');
              $('.has-error').removeClass('has-error');
              $inputs.each(function(i, el) {
                  var $input = $(el);
                  if ($input.val() === '') {
                      $input.parent().addClass('has-error');
                      $errorMessage.removeClass('hide');
                      e.preventDefault();
                  }
              });
              if (!$form.data('cc-on-file')) {
                  e.preventDefault();
                  Stripe.setPublishableKey($form.data('stripe-publishable-key'));

                  Stripe.createToken({
                      number: $('.card-number').val(),
                      cvc: $('.card-cvc').val(),
                      exp_month: expiry_array[0],
                      exp_year: expiry_array[1]
                  }, stripeResponseHandler);
              }
          });

          function stripeResponseHandler(status, response) {
              $("#loading").css({
                  display: "none"

              });
              $("#content").css("opacity","1");
              if (response.error) {
                  $('.error')
                      .removeClass('hide')
                      .find('.alert')
                      .text(response.error.message);
				  alert(response.error.message);
              } else {
                  /* token contains id, last4, and card type */
                  var token = response['id'];
                  $form.find('input[type=text]').empty();
                  $form.append("<input type='hidden' name='stripeToken' value='" + token + "'/>");
                  $form.get(0).submit();
              }
          }
      });
  </script>

</html>
